# Framework

程序的主要部分代码在`projects/main`项目里面。

## 基础框架

主项目分为几个部分，根据文件夹区分。

- `extensions` : 里面存放一些拓展代码以及第三方库的包装，尽量避免在代码里面直接调用第三方库函数。
- `interfaces` : 存放一些抽象类的地方，设计的接口存放在此处。
- `resources` : 存放游戏资源的文件夹，例如说一些图片，设置文件，存档等存放此处。
- `runtime` : 运行期的代码文件，主要存放一些代码组件用来管理整个运行的代码。
- `systems` : 程序的系统代码存放目录，主要逻辑代码和UI代码存放此处。

大部分情况下，只需要对resources和systems里面的文件进行添加和修改。其他目录的文件很少会涉及修改，属于框架运行的时候的管理。

## 运行时组件

在`runtime`部分提供了一系列运行时组件，用来帮助开发者实现各种功能。所有的运行时组件，开发者可以在`service`实例中获取到，而`service`则是一个`runtime_service`类型，作为参数传递给开发者(当开发者开发一个system的时候)。

- `input` ： 一个输入系统，可以为检查按键状态和输入状态。
- `reboot` : 重启系统的集合，开发者编写的重启系统可以通过组件加载到程序中去。
- `render` ：渲染系统的集合，开发者编写的渲染系统可以通过组件加载到程序中去。
- `resources` : 资源系统的集合，开发者可以通过资源系统添加新的资源或者获取其他资源(例如其他系统的资源)，也可以实现多系统之间的交互。
- `update` ： 更新系统的集合，开发者编写的更新系统可以通过组件加载到程序中去。
- `windows` ： 窗口系统的集合，开发者可以获取窗口的一些信息。

## 系统

框架的运行的本质是顺序运行多个系统。例如运行重启系统加载程序初始化的资源，例如运行更新系统去检查当前的程序状态，更新程序状态(比如说处理游戏的逻辑)，运行渲染系统将我们的图形界面渲染到窗口。

在每一帧中，框架会通过运行时组件按照顺序和优先级调用更新系统和渲染系统，即它们的`update`函数。而对于重启系统，将会在程序进入主循环之前调用，用来加载程序(对于重启系统来说，最简单的实例就是通过重启系统读取配置文件加载需要的系统)。

## 我们的设计

那么一个简单的想法就可以提了出来，我们维护两种更新系统(注意是两种，而不是两个，为了便于开发我们可以将逻辑解耦，用一组系统来完成我们的任务，而不是一个)。优先执行的是我们的游戏逻辑系统，用来接收我们的输入以及判断该如何去做，以及告诉我们的UI系统如何显示我们的界面。然后执行的是我们的UI系统，接收来自逻辑系统的指示，调用ImGui渲染对应的图形页面，UI系统也可以接收用户的输入，然后告知逻辑系统。

在这两种系统之间，我们可以通过运行时组件，例如资源系统来存放资源进行交互，比如说消息队列。